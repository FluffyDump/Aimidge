@page
@model IndexModel
@{
	ViewData["Title"] = "Home page";
}

<div class="text-center">
	<h1 class="display-4">Welcome to AIMIDGE!</h1>
	<label for="prompt">Enter your prompt!</label><br />
	<input type="text" id="prompt" name="prompt" /><br />

	<label for="resolution">Select resolution:</label><br />
	<select id="resolution" name="resolution">
		<option value="100x100">100x100</option>
		<option value="150x150">150x150</option>
		<option value="320x240">320x240</option>
		<option value="400x300">400x300</option>
		<option value="512x512">512x512</option>
	</select><br />
	<button id="submitButton" type="button">Submit</button>

	<div id="promptImage"></div>

	<div id="loadingSpinner" style="display: none;">
        <img src="/loading.gif" alt="Loading..." />
    </div>

	<script>
		document.getElementById('submitButton').addEventListener('click', function () {
			document.getElementById('promptImage').innerHTML = '';
			const promptText = document.getElementById('prompt').value;
			const resolution = document.getElementById('resolution').value; // Get selected resolution
	
			document.getElementById('loadingSpinner').style.display = 'block';

			const response = fetch('api/GetPrompt', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify({ prompt: promptText, resolution: resolution })
			});

			response.then(res => {
				if (res.ok) {
					res.json().then(data => {
						const img = document.createElement('img');
						img.src = 'data:image/jpg;base64,' + data.image;
						document.getElementById('promptImage').appendChild(img);
						document.getElementById('loadingSpinner').style.display = 'none';
					})
				} else {
					console.error(res.statusText);
					document.getElementById('loadingSpinner').style.display = 'none';
				}
			}).catch(error => {
				console.error(error);
				document.getElementById('loadingSpinner').style.display = 'none';
			});
		});
	</script>
</div>
